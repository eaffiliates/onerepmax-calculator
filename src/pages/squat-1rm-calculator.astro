---
import Layout from '../layouts/Layout.astro';
import Calculator from '../components/Calculator.astro';
---

<Layout 
  title="Squat 1RM Calculator - Calculate Your Squat Max" 
  description="Calculate your squat 1RM (one rep max) using proven formulas. Get accurate squat max estimates with confidence intervals, form tips, and strength standards. Free squat calculator for powerlifting and strength training."
>
  <div class="min-h-screen relative overflow-hidden bg-gradient-to-br from-gray-50 via-blue-50 to-gray-100">
    <!-- Subtle background pattern -->
    <div class="absolute inset-0 bg-[url('data:image/svg+xml,%3Csvg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"%3E%3Cg fill="none" fill-rule="evenodd"%3E%3Cg fill="%23f8fafc" fill-opacity="0.4"%3E%3Ccircle cx="30" cy="30" r="1"/%3E%3C/g%3E%3C/g%3E%3C/svg%3E')] opacity-60"></div>

    <!-- Header with Logo and Name -->
    <header class="relative z-20 pt-8 pb-12">
      <div class="max-w-7xl mx-auto px-6">
        <div class="flex items-center space-x-4">
          <!-- Logo -->
          <div class="w-12 h-12 bg-gradient-to-br from-blue-600 to-gray-700 rounded-xl flex items-center justify-center shadow-lg">
            <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
            </svg>
          </div>
          
          <!-- Website Name -->
          <div>
            <h1 class="text-4xl font-bold text-gray-800 tracking-tight">OneRepMax</h1>
            <p class="text-gray-600 text-lg font-medium">Calculate Your Strength</p>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <div class="relative z-10">
      <!-- Breadcrumb Navigation -->
      <div class="max-w-7xl mx-auto px-6 mb-6">
        <nav class="mb-6" aria-label="Breadcrumb">
          <ol class="flex items-center space-x-2 text-sm text-gray-600">
            <li><a href="/" class="text-gray-600 hover:text-blue-600 transition-colors duration-200">1RM Calculator</a></li>
            <li class="before:content-['/'] before:mr-2 text-gray-800">Squat Calculator</li>
          </ol>
        </nav>
      </div>

      <!-- Page Title -->
      <div class="text-center mb-8 px-6">
        <h2 class="text-4xl font-bold text-gray-800 mb-4">Squat 1RM Calculator</h2>
        <p class="text-gray-600 text-lg max-w-2xl mx-auto">
          Calculate your squat one-rep max using proven scientific formulas. Get accurate estimates with confidence intervals and personalized warm-up recommendations.
        </p>
      </div>

      <!-- Calculator Card -->
      <div class="max-w-7xl mx-auto px-6 mb-16">
        <div class="bg-white rounded-3xl shadow-xl border border-gray-200 p-8">
          <!-- Calculator Title -->
          <h3 class="text-2xl font-semibold text-gray-900 mb-6 text-center">Squat Calculator</h3>
          
          <!-- Calculator Form -->
          <div class="grid lg:grid-cols-2 gap-8 items-start">
            <!-- Input Section -->
            <div class="space-y-6">
              <!-- Unit Toggle -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Units</label>
                <div class="flex bg-gray-100 rounded-xl p-1">
                  <button
                    id="lb-btn"
                    class="flex-1 py-2 px-4 rounded-lg font-medium transition-all duration-200"
                  >
                    Pounds (lb)
                  </button>
                  <button
                    id="kg-btn"
                    class="flex-1 py-2 px-4 rounded-lg font-medium transition-all duration-200"
                  >
                    Kilograms (kg)
                  </button>
                </div>
              </div>
              
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label for="weight" class="block text-sm font-medium text-gray-700 mb-2">Weight</label>
                  <input
                    type="number"
                    id="weight"
                    step="1"
                    min="0"
                    placeholder="0"
                    class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200"
                  />
                  <p id="weight-help" class="text-sm text-gray-500 mt-1">Weight you lifted (in lb)</p>
                </div>
                
                <div>
                  <label for="reps" class="block text-sm font-medium text-gray-700 mb-2">Reps</label>
                  <input
                    type="number"
                    id="reps"
                    min="1"
                    max="12"
                    placeholder="0"
                    class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200"
                  />
                  <p class="text-sm text-gray-500 mt-1">Repetitions performed</p>
                </div>
              </div>
              
              <!-- Calculate Button -->
              <button
                id="calculate-btn"
                class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-4 px-8 rounded-xl font-semibold text-lg hover:from-blue-700 hover:to-purple-700 transform hover:scale-105 transition-all duration-200 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"
              >
                Calculate Squat 1RM
              </button>
              
              <!-- Validation Error -->
              <div id="validation-error" class="hidden text-red-600 text-sm bg-red-50 border border-red-200 rounded-lg p-3"></div>
            </div>
        
            <!-- Results Section -->
            <div id="results-section" class="hidden space-y-6">
              <!-- Main Result -->
              <div class="text-center">
                <h3 class="text-lg font-medium text-gray-600 mb-2">Your Predicted Squat 1RM</h3>
                <div id="median-result" class="text-5xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">--</div>
              </div>
              
              <!-- Range Display -->
              <div class="bg-gray-50 rounded-2xl p-6">
                <h4 class="text-lg font-semibold text-gray-800 mb-4">Confidence Range</h4>
                
                <!-- Simple Range Display -->
                <div class="flex items-center justify-between mb-6">
                  <div class="text-center">
                    <div class="text-sm text-gray-500 mb-1">Low</div>
                    <div id="min-result" class="text-2xl font-bold text-blue-600">--</div>
                  </div>
                  <div class="text-center">
                    <div class="text-sm text-gray-500 mb-1">High</div>
                    <div id="max-result" class="text-2xl font-bold text-blue-600">--</div>
                  </div>
                </div>
                
                <!-- Clean Range Band -->
                <div class="relative">
                  <div class="h-4 bg-gray-200 rounded-full overflow-hidden">
                    <div class="h-4 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full"></div>
                  </div>
                  <div class="flex justify-between text-xs text-gray-500 mt-2">
                    <span>Low</span>
                    <span>High</span>
                  </div>
                </div>
              </div>
              
              <p class="text-gray-600 text-sm text-center">
                Based on 4 proven formulas: Epley, Brzycki, Lombardi, and O'Conner
              </p>
              
              <!-- Share Button -->
              <div class="text-center">
                <button
                  id="share-btn"
                  class="bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 px-6 rounded-xl font-semibold hover:from-blue-700 hover:to-purple-700 transform hover:scale-105 transition-all duration-200 shadow-lg"
                >
                  ðŸ“‹ Copy Link
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Squat Specific Content -->
      <div class="max-w-4xl mx-auto px-6 mb-16">
        <div class="bg-white/95 backdrop-blur-sm rounded-3xl shadow-2xl border border-white/20 p-8">
          <h3 class="text-2xl font-bold text-gray-900 mb-6">Squat Form & Safety Tips</h3>
          
          <div class="grid md:grid-cols-2 gap-8">
            <div>
              <h4 class="text-lg font-semibold text-gray-800 mb-3">Proper Form Checklist</h4>
              <ul class="space-y-2 text-gray-600">
                <li class="flex items-start">
                  <span class="text-green-500 mr-2">âœ“</span>
                  Feet shoulder-width apart, toes slightly out
                </li>
                <li class="flex items-start">
                  <span class="text-green-500 mr-2">âœ“</span>
                  Bar positioned on upper back, not neck
                </li>
                <li class="flex items-start">
                  <span class="text-green-500 mr-2">âœ“</span>
                  Chest up, core tight throughout movement
                </li>
                <li class="flex items-start">
                  <span class="text-green-500 mr-2">âœ“</span>
                  Break at hips and knees simultaneously
                </li>
                <li class="flex items-start">
                  <span class="text-green-500 mr-2">âœ“</span>
                  Descend until thighs are parallel to floor
                </li>
              </ul>
            </div>
            
            <div>
              <h4 class="text-lg font-semibold text-gray-800 mb-3">Safety Considerations</h4>
              <ul class="space-y-2 text-gray-600">
                <li class="flex items-start">
                  <span class="text-red-500 mr-2">âš </span>
                  Always use a squat rack with safety bars
                </li>
                <li class="flex items-start">
                  <span class="text-red-500 mr-2">âš </span>
                  Warm up thoroughly before heavy attempts
                </li>
                <li class="flex items-start">
                  <span class="text-red-500 mr-2">âš </span>
                  Don't let knees cave inward
                </li>
                <li class="flex items-start">
                  <span class="text-red-500 mr-2">âš </span>
                  Keep weight centered over mid-foot
                </li>
                <li class="flex items-start">
                  <span class="text-red-500 mr-2">âš </span>
                  Have a spotter for maximum attempts
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <!-- Squat Strength Standards -->
      <div class="max-w-4xl mx-auto px-6 mb-16">
        <div class="bg-white/95 backdrop-blur-sm rounded-3xl shadow-2xl border border-white/20 p-8">
          <h3 class="text-2xl font-bold text-gray-900 mb-6">Squat Strength Standards</h3>
          
          <div class="overflow-x-auto">
            <table class="w-full text-sm">
              <thead>
                <tr class="border-b border-gray-200">
                  <th class="text-left py-3 px-4 font-semibold text-gray-700">Experience Level</th>
                  <th class="text-center py-3 px-4 font-semibold text-gray-700">Beginner</th>
                  <th class="text-center py-3 px-4 font-semibold text-gray-700">Intermediate</th>
                  <th class="text-center py-3 px-4 font-semibold text-gray-700">Advanced</th>
                  <th class="text-center py-3 px-4 font-semibold text-gray-700">Elite</th>
                </tr>
              </thead>
              <tbody>
                <tr class="border-b border-gray-100">
                  <td class="py-3 px-4 font-medium text-gray-700">Bodyweight Ratio</td>
                  <td class="text-center py-3 px-4 text-gray-600">1.0x</td>
                  <td class="text-center py-3 px-4 text-gray-600">1.5x</td>
                  <td class="text-center py-3 px-4 text-gray-600">2.0x</td>
                  <td class="text-center py-3 px-4 text-gray-600">2.5x+</td>
                </tr>
                <tr class="border-b border-gray-100">
                  <td class="py-3 px-4 font-medium text-gray-700">Training Time</td>
                  <td class="text-center py-3 px-4 text-gray-600">0-1 years</td>
                  <td class="text-center py-3 px-4 text-gray-600">1-3 years</td>
                  <td class="text-center py-3 px-4 text-gray-600">3-5 years</td>
                  <td class="text-center py-3 px-4 text-gray-600">5+ years</td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <p class="text-sm text-gray-500 mt-4 text-center">
            *Standards based on average male lifters. Individual results may vary based on genetics, training consistency, and other factors.
          </p>
        </div>
      </div>

      <!-- Related Calculators -->
      <div class="max-w-4xl mx-auto px-6 mb-16">
        <div class="bg-white/95 backdrop-blur-sm rounded-3xl shadow-2xl border border-white/20 p-8">
          <h3 class="text-2xl font-bold text-gray-900 mb-6">Other Strength Calculators</h3>
          
          <div class="grid md:grid-cols-3 gap-4">
            <a href="/bench-press-1rm-calculator/" class="block p-4 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors duration-200">
              <h4 class="font-semibold text-gray-800 mb-2">Bench Press 1RM Calculator</h4>
              <p class="text-sm text-gray-600">Calculate your bench press one-rep max with confidence intervals and form tips.</p>
            </a>
            
            <a href="/deadlift-1rm-calculator/" class="block p-4 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors duration-200">
              <h4 class="font-semibold text-gray-800 mb-2">Deadlift 1RM Calculator</h4>
              <p class="text-sm text-gray-600">Estimate your deadlift max using proven formulas and safety guidelines.</p>
            </a>
            
            <a href="/" class="block p-4 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors duration-200">
              <h4 class="font-semibold text-gray-800 mb-2">General 1RM Calculator</h4>
              <p class="text-sm text-gray-600">Universal 1RM calculator for any compound exercise.</p>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Import the same calculator logic
    import { calculateOneRM, formatOneRM } from '../utils/formulas.js';
    import { convertWeight } from '../utils/units.js';
    import { generatePermalink, parsePermalink } from '../utils/permalink.js';
    
    // Same calculator functionality as main page
    let currentUnit = 'lb';
    let currentResults: any = null;
    
    // DOM elements
    const weightInput = document.getElementById('weight') as HTMLInputElement;
    const repsInput = document.getElementById('reps') as HTMLInputElement;
    const calculateBtn = document.getElementById('calculate-btn') as HTMLButtonElement;
    const kgBtn = document.getElementById('kg-btn') as HTMLButtonElement;
    const lbBtn = document.getElementById('lb-btn') as HTMLButtonElement;
    const resultsSection = document.getElementById('results-section') as HTMLElement;
    const validationError = document.getElementById('validation-error') as HTMLElement;
    const medianResult = document.getElementById('median-result') as HTMLElement;
    const shareBtn = document.getElementById('share-btn') as HTMLButtonElement;
    
    // Initialize from URL params
    function initializeFromURL() {
      const state = parsePermalink();
      if (state.weight) weightInput.value = state.weight.toString();
      if (state.reps) repsInput.value = state.reps.toString();
      if (state.units) {
        currentUnit = state.units;
        updateUnitButtons();
      }
      
      if (state.weight && state.reps) {
        validateAndCalculate();
      }
    }
    
    // Unit toggle
    function updateUnitButtons() {
      if (currentUnit === 'kg') {
        kgBtn.classList.add('bg-white', 'text-gray-900', 'shadow-md');
        kgBtn.classList.remove('text-gray-600');
        lbBtn.classList.add('text-gray-600');
        lbBtn.classList.remove('bg-white', 'text-gray-900', 'shadow-md');
      } else {
        lbBtn.classList.add('bg-white', 'text-gray-900', 'shadow-md');
        kgBtn.classList.remove('text-gray-600');
        kgBtn.classList.add('text-gray-600');
        kgBtn.classList.remove('bg-white', 'text-gray-900', 'shadow-md');
      }
    }
    
    function switchUnits(newUnit) {
      if (currentUnit === newUnit) return;
      
      const currentWeight = parseFloat(weightInput.value);
      if (!isNaN(currentWeight)) {
        const convertedWeight = convertWeight(currentWeight, currentUnit, newUnit);
        weightInput.value = convertedWeight.toFixed(newUnit === 'kg' ? 1 : 0);
      }
      
      weightInput.step = newUnit === 'kg' ? '0.5' : '1';
      
      const weightHelp = document.getElementById('weight-help');
      if (weightHelp) {
        weightHelp.textContent = `Weight you lifted (in ${newUnit})`;
      }
      
      currentUnit = newUnit;
      updateUnitButtons();
      
      if (currentResults) {
        displayResults(currentResults);
      }
    }
    
    // Validation
    function validateInputs(): string | null {
      const weight = parseFloat(weightInput.value);
      const reps = parseInt(repsInput.value);
      
      if (isNaN(weight) || weight <= 0) {
        return 'Please enter a valid weight greater than 0';
      }
      
      if (isNaN(reps) || reps < 1 || reps > 12) {
        return 'Please enter reps between 1 and 12 for accurate estimates';
      }
      
      return null;
    }
    
    function validateAndCalculate() {
      const error = validateInputs();
      
      if (error) {
        validationError.textContent = error;
        validationError.classList.remove('hidden');
        calculateBtn.disabled = true;
        hideResults();
        return;
      }
      
      validationError.classList.add('hidden');
      calculateBtn.disabled = false;
      
      calculate();
    }
    
    function calculate() {
      try {
        const weight = parseFloat(weightInput.value);
        const reps = parseInt(repsInput.value);
        
        if (isNaN(weight) || isNaN(reps)) {
          throw new Error('Invalid input values');
        }
        
        const results = calculateOneRM(weight, reps);
        currentResults = results;
        
        displayResults(results);
        updateURL();
        
      } catch (error) {
        console.error('Error calculating 1RM:', error);
        validationError.textContent = 'Error calculating 1RM. Please check your inputs.';
        validationError.classList.remove('hidden');
      }
    }
    
    function displayResults(results: any) {
      resultsSection.classList.remove('hidden');
      
      const isKg = currentUnit === 'kg';
      const formatFunc = typeof formatOneRM === 'function' ? formatOneRM : formatOneRMInline;
      
      // Update main result
      medianResult.textContent = formatFunc(results.median, isKg);
      
      // Update range results
      document.getElementById('min-result')!.textContent = formatFunc(results.min, isKg);
      document.getElementById('max-result')!.textContent = formatFunc(results.max, isKg);
      
      // Announce to screen readers
      const announcement = `Squat 1RM calculated: ${formatFunc(results.median, isKg)} with range from ${formatFunc(results.min, isKg)} to ${formatFunc(results.max, isKg)}`;
      announceToScreenReader(announcement);
    }
    
    function formatOneRMInline(value: number, isKg: boolean): string {
      const increment = isKg ? 0.5 : 1;
      const rounded = Math.round(value / increment) * increment;
      return `${rounded.toFixed(isKg ? 1 : 0)} ${isKg ? 'kg' : 'lb'}`;
    }
    
    function hideResults() {
      resultsSection.classList.add('hidden');
    }
    
    function updateURL() {
      if (typeof window === 'undefined') return;
      
      const weight = parseFloat(weightInput.value);
      const reps = parseInt(repsInput.value);
      
      if (!isNaN(weight) && !isNaN(reps)) {
        const state = { weight, reps, units: currentUnit };
        const url = generatePermalink(state);
        window.history.replaceState({}, '', url);
      }
    }
    
    function announceToScreenReader(message: string) {
      const announcer = document.createElement('div');
      announcer.setAttribute('aria-live', 'polite');
      announcer.setAttribute('aria-atomic', 'true');
      announcer.style.position = 'absolute';
      announcer.style.left = '-10000px';
      announcer.textContent = message;
      document.body.appendChild(announcer);
      setTimeout(() => document.body.removeChild(announcer), 1000);
    }
    
    // Event listeners
    kgBtn.addEventListener('click', () => switchUnits('kg'));
    lbBtn.addEventListener('click', () => switchUnits('lb'));
    
    weightInput.addEventListener('input', validateAndCalculate);
    repsInput.addEventListener('input', validateAndCalculate);
    calculateBtn.addEventListener('click', calculate);
    
    shareBtn.addEventListener('click', async () => {
      const url = generatePermalink({
        weight: parseFloat(weightInput.value),
        reps: parseInt(repsInput.value),
        units: currentUnit
      });
      
      try {
        await navigator.clipboard.writeText(url);
        shareBtn.textContent = 'âœ“ Copied!';
        setTimeout(() => shareBtn.textContent = 'ðŸ“‹ Copy Link', 2000);
      } catch (err) {
        console.error('Failed to copy link:', err);
      }
    });
    
    // Initialize
    initializeFromURL();
    updateUnitButtons();
  </script>
</Layout> 